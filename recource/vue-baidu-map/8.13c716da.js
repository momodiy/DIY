webpackJsonp([8],{"797M":function(t,a,e){var n,s,l;!function(i,o){s=[t,a,e("j3lb"),e("wuLl")],n=o,void 0!==(l="function"==typeof n?n.apply(a,s):n)&&(t.exports=l)}(0,function(t,a,e,n){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(a,"__esModule",{value:!0});var l=s(e),i=s(n);a.default={name:"bml-heatmap",render:function(){},mixins:[(0,l.default)("overlay")],props:{data:{type:Array,default:Array},max:{type:Number},radius:{type:Number},gradient:{type:Object},opacity:{type:Number}},watch:{data:{handler:function(){this.reload()},deep:!0},max:function(){this.reload()},radius:function(t){var a=this.originInstance,e=this.opacity,n=this.gradient;a.setOptions({radius:t,opacity:e,gradient:n})},gradient:{handler:function(t){var a=this.originInstance,e=this.radius,n=this.opacity;a.setOptions({radius:e,opacity:n,gradient:t})},deep:!0},opacity:function(t){var a=this.originInstance,e=this.radius,n=this.gradient;a.setOptions({radius:e,opacity:t,gradient:n})}},methods:{load:function(){var t=this.map,a=this.data,e=this.max,n=this.radius,s=this.opacity,l=this.gradient,o=this.originInstance=new i.default({radius:n,opacity:s,gradient:l});t.addOverlay(o),o.setDataSet({data:a,max:e})}}},t.exports=a.default})},"978o":function(t,a,e){var n,s,l;!function(i,o){s=[t,a,e("JERA")],n=o,void 0!==(l="function"==typeof n?n.apply(a,s):n)&&(t.exports=l)}(0,function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=function(t){return t&&t.__esModule?t:{default:t}}(e);a.default={components:{BmlHeatmap:n.default},data:function(){return{data:[{lng:116.418261,lat:39.921984,count:50},{lng:116.423332,lat:39.916532,count:51},{lng:116.419787,lat:39.930658,count:15},{lng:116.418455,lat:39.920921,count:40},{lng:116.418843,lat:39.915516,count:100},{lng:116.42546,lat:39.918503,count:6},{lng:116.423289,lat:39.919989,count:18},{lng:116.418162,lat:39.915051,count:80},{lng:116.422039,lat:39.91782,count:11},{lng:116.41387,lat:39.917253,count:7},{lng:116.41773,lat:39.919426,count:42},{lng:116.421107,lat:39.916445,count:4},{lng:116.417521,lat:39.917943,count:27},{lng:116.419812,lat:39.920836,count:23},{lng:116.420682,lat:39.91463,count:60},{lng:116.415424,lat:39.924675,count:8},{lng:116.419242,lat:39.914509,count:15},{lng:116.422766,lat:39.921408,count:25},{lng:116.421674,lat:39.924396,count:21},{lng:116.427268,lat:39.92267,count:1},{lng:116.417721,lat:39.920034,count:51},{lng:116.412456,lat:39.92667,count:7},{lng:116.420432,lat:39.919114,count:11},{lng:116.425013,lat:39.921611,count:35},{lng:116.418733,lat:39.931037,count:22},{lng:116.419336,lat:39.931134,count:4},{lng:116.413557,lat:39.923254,count:5},{lng:116.418367,lat:39.92943,count:3},{lng:116.424312,lat:39.919621,count:100},{lng:116.423874,lat:39.919447,count:87},{lng:116.424225,lat:39.923091,count:32},{lng:116.417801,lat:39.921854,count:44},{lng:116.417129,lat:39.928227,count:21},{lng:116.426426,lat:39.922286,count:80},{lng:116.421597,lat:39.91948,count:32},{lng:116.423895,lat:39.920787,count:26},{lng:116.423563,lat:39.921197,count:17},{lng:116.417982,lat:39.922547,count:17},{lng:116.426126,lat:39.921938,count:25},{lng:116.42326,lat:39.915782,count:100},{lng:116.419239,lat:39.916759,count:39},{lng:116.417185,lat:39.929123,count:11},{lng:116.417237,lat:39.927518,count:9},{lng:116.417784,lat:39.915754,count:47},{lng:116.420193,lat:39.917061,count:52},{lng:116.422735,lat:39.915619,count:100},{lng:116.418495,lat:39.915958,count:46},{lng:116.416292,lat:39.931166,count:9},{lng:116.419916,lat:39.924055,count:8},{lng:116.42189,lat:39.921308,count:11},{lng:116.413765,lat:39.929376,count:3},{lng:116.418232,lat:39.920348,count:50},{lng:116.417554,lat:39.930511,count:15},{lng:116.418568,lat:39.918161,count:23},{lng:116.413461,lat:39.926306,count:3},{lng:116.42232,lat:39.92161,count:13},{lng:116.4174,lat:39.928616,count:6},{lng:116.424679,lat:39.915499,count:21},{lng:116.42171,lat:39.915738,count:29},{lng:116.417836,lat:39.916998,count:99},{lng:116.420755,lat:39.928001,count:10},{lng:116.414077,lat:39.930655,count:14},{lng:116.426092,lat:39.922995,count:16},{lng:116.41535,lat:39.931054,count:15},{lng:116.413022,lat:39.921895,count:13},{lng:116.415551,lat:39.913373,count:17},{lng:116.421191,lat:39.926572,count:1},{lng:116.419612,lat:39.917119,count:9},{lng:116.418237,lat:39.921337,count:54},{lng:116.423776,lat:39.921919,count:26},{lng:116.417694,lat:39.92536,count:17},{lng:116.415377,lat:39.914137,count:19},{lng:116.417434,lat:39.914394,count:43},{lng:116.42588,lat:39.922622,count:27},{lng:116.418345,lat:39.919467,count:8},{lng:116.426883,lat:39.917171,count:3},{lng:116.423877,lat:39.916659,count:34},{lng:116.415712,lat:39.915613,count:14},{lng:116.419869,lat:39.931416,count:12},{lng:116.416956,lat:39.925377,count:11},{lng:116.42066,lat:39.925017,count:38},{lng:116.416244,lat:39.920215,count:91},{lng:116.41929,lat:39.915908,count:54},{lng:116.422116,lat:39.919658,count:21},{lng:116.4183,lat:39.925015,count:15},{lng:116.421969,lat:39.913527,count:3},{lng:116.422936,lat:39.921854,count:24},{lng:116.41905,lat:39.929217,count:12},{lng:116.424579,lat:39.914987,count:57},{lng:116.42076,lat:39.915251,count:70},{lng:116.425867,lat:39.918989,count:8}]}}},t.exports=a.default})},BwGC:function(t,a){t.exports={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("section",[e("h1",[t._v("热力图")]),t._v(" "),t._m(0),t._v(" "),e("h2",[t._v("属性")]),t._v(" "),t._m(1),t._v(" "),e("h2",[t._v("示例")]),t._v(" "),e("h3",[t._v("添加一个热力图")]),t._v(" "),e("h4",[t._v("代码")]),t._v(" "),t._m(2),t._v(" "),e("h4",[t._v("预览")]),t._v(" "),e("baidu-map",{staticClass:"map",attrs:{center:{lng:116.404,lat:39.915},zoom:14}},[e("bml-heatmap",{attrs:{data:t.data,max:100,radius:20}})],1)],1)},staticRenderFns:[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("p",[e("code",[t._v("BmlHeatmap")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("table",[e("thead",[e("tr",[e("th",[t._v("属性名")]),t._v(" "),e("th",[t._v("类型")]),t._v(" "),e("th",[t._v("默认值")]),t._v(" "),e("th",[t._v("描述")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("data")]),t._v(" "),e("td",[t._v("Array[{lng, lat, count}]")]),t._v(" "),e("td",[t._v("[]")]),t._v(" "),e("td",[t._v("设置热力图的点坐标和权重值的集合")])]),t._v(" "),e("tr",[e("td",[t._v("max")]),t._v(" "),e("td",[t._v("Number")]),t._v(" "),e("td"),t._v(" "),e("td",[t._v("权重最大值")])]),t._v(" "),e("tr",[e("td",[t._v("radius")]),t._v(" "),e("td",[t._v("Number")]),t._v(" "),e("td"),t._v(" "),e("td",[t._v("热力图半径")])]),t._v(" "),e("tr",[e("td",[t._v("gradient")]),t._v(" "),e("td",[t._v("Object")]),t._v(" "),e("td"),t._v(" "),e("td",[t._v("热力图渐变区间，如： "),e("code",[t._v("{5:'rgb(0, 110, 255)',.8:'rgb(100, 0, 255)'}")]),t._v("，其中 key 表示插值的位置，取值范围 0 ~ 1，value 为颜色值。")])]),t._v(" "),e("tr",[e("td",[t._v("opacity")]),t._v(" "),e("td",[t._v("Number")]),t._v(" "),e("td"),t._v(" "),e("td",[t._v("热力图透明度")])])])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("pre",[e("code",{staticClass:"language-html"},[e("span",{staticClass:"hljs-tag"},[t._v("<"),e("span",{staticClass:"hljs-name"},[t._v("baidu-map")]),t._v(" "),e("span",{staticClass:"hljs-attr"},[t._v("class")]),t._v("="),e("span",{staticClass:"hljs-string"},[t._v('"map"')]),t._v(" "),e("span",{staticClass:"hljs-attr"},[t._v(":center")]),t._v("="),e("span",{staticClass:"hljs-string"},[t._v('"{lng: 116.404, lat: 39.915}"')]),t._v(" "),e("span",{staticClass:"hljs-attr"},[t._v(":zoom")]),t._v("="),e("span",{staticClass:"hljs-string"},[t._v('"14"')]),t._v(">")]),t._v("\n  "),e("span",{staticClass:"hljs-tag"},[t._v("<"),e("span",{staticClass:"hljs-name"},[t._v("bml-heatmap")]),t._v(" "),e("span",{staticClass:"hljs-attr"},[t._v(":data")]),t._v("="),e("span",{staticClass:"hljs-string"},[t._v('"data"')]),t._v(" "),e("span",{staticClass:"hljs-attr"},[t._v(":max")]),t._v("="),e("span",{staticClass:"hljs-string"},[t._v('"100"')]),t._v(" "),e("span",{staticClass:"hljs-attr"},[t._v(":radius")]),t._v("="),e("span",{staticClass:"hljs-string"},[t._v('"20"')]),t._v(">")]),t._v("\n  "),e("span",{staticClass:"hljs-tag"},[t._v("</"),e("span",{staticClass:"hljs-name"},[t._v("bml-heatmap")]),t._v(">")]),t._v("\n"),e("span",{staticClass:"hljs-tag"},[t._v("</"),e("span",{staticClass:"hljs-name"},[t._v("baidu-map")]),t._v(">")]),t._v("\n\n"),e("span",{staticClass:"hljs-tag"},[t._v("<"),e("span",{staticClass:"hljs-name"},[t._v("script")]),t._v(">")]),e("span",{staticClass:"javascript"},[t._v("\n"),e("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" {BmlHeatmap} "),e("span",{staticClass:"hljs-keyword"},[t._v("from")]),t._v(" "),e("span",{staticClass:"hljs-string"},[t._v("'vue-baidu-map'")]),t._v("\n\n"),e("span",{staticClass:"hljs-keyword"},[t._v("export")]),t._v(" "),e("span",{staticClass:"hljs-keyword"},[t._v("default")]),t._v(" {\n  "),e("span",{staticClass:"hljs-attr"},[t._v("components")]),t._v(": {\n    BmlHeatmap\n  },\n  data () {\n    "),e("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" {\n      "),e("span",{staticClass:"hljs-attr"},[t._v("data")]),t._v(": [\n        {"),e("span",{staticClass:"hljs-attr"},[t._v("lng")]),t._v(": "),e("span",{staticClass:"hljs-number"},[t._v("116.418261")]),t._v(", "),e("span",{staticClass:"hljs-attr"},[t._v("lat")]),t._v(": "),e("span",{staticClass:"hljs-number"},[t._v("39.921984")]),t._v(", "),e("span",{staticClass:"hljs-attr"},[t._v("count")]),t._v(": "),e("span",{staticClass:"hljs-number"},[t._v("50")]),t._v("},\n        {"),e("span",{staticClass:"hljs-attr"},[t._v("lng")]),t._v(": "),e("span",{staticClass:"hljs-number"},[t._v("116.423332")]),t._v(", "),e("span",{staticClass:"hljs-attr"},[t._v("lat")]),t._v(": "),e("span",{staticClass:"hljs-number"},[t._v("39.916532")]),t._v(", "),e("span",{staticClass:"hljs-attr"},[t._v("count")]),t._v(": "),e("span",{staticClass:"hljs-number"},[t._v("51")]),t._v("},\n        {"),e("span",{staticClass:"hljs-attr"},[t._v("lng")]),t._v(": "),e("span",{staticClass:"hljs-number"},[t._v("116.419787")]),t._v(", "),e("span",{staticClass:"hljs-attr"},[t._v("lat")]),t._v(": "),e("span",{staticClass:"hljs-number"},[t._v("39.930658")]),t._v(", "),e("span",{staticClass:"hljs-attr"},[t._v("count")]),t._v(": "),e("span",{staticClass:"hljs-number"},[t._v("15")]),t._v("}\n        "),e("span",{staticClass:"hljs-comment"},[t._v("// ...此处添加更多的数据集")]),t._v("\n      ]\n    }\n  }\n}\n")]),e("span",{staticClass:"hljs-tag"},[t._v("</"),e("span",{staticClass:"hljs-name"},[t._v("script")]),t._v(">")]),t._v("\n")])])}]}},JERA:function(t,a,e){var n=e("VU/8")(e("797M"),null,null,null);t.exports=n.exports},My2N:function(t,a,e){var n=e("VU/8")(e("978o"),e("BwGC"),null,null);t.exports=n.exports},WvsZ:function(t,a,e){t.exports=e("My2N")},j3lb:function(t,a,e){var n,s,l;!function(e,i){s=[t,a],n=i,void 0!==(l="function"==typeof n?n.apply(a,s):n)&&(t.exports=l)}(0,function(t,a){"use strict";function e(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function n(){var t=this.unload,a=this.renderByParent,e=this.$parent;a&&e.reload(),t()}Object.defineProperty(a,"__esModule",{value:!0});var s={control:{unload:"removeControl"},layer:{unload:"removeTileLayer"},overlay:{unload:"removeOverlay"},contextMenu:{unload:"removeContextMenu"}},l=function t(a){return a.abstract||a.$el===a.$children[0].$el?t(a.$parent):a},i=function t(a){e(this,t),this.methods={ready:function(){var t=l(this.$parent),a=this.BMap=t.BMap,e=this.map=t.map;this.load(),this.$emit("ready",{BMap:a,map:e})},transmitEvent:function(t){this.$emit(t.type.replace(/^on/,""),t)},reload:function(){var t=this;this&&this.BMap&&this.$nextTick(function(){t.unload(),t.$nextTick(t.load)})},unload:function(){var t=this.map,e=this.originInstance;try{switch(a.type){case"search":return e.clearResults();case"autoComplete":case"lushu":return e.dispose();case"markerClusterer":return e.clearMarkers();default:t[s[a.type].unload](e)}}catch(t){}}},this.computed={renderByParent:function(){return this.$parent.preventChildrenRender}},this.mounted=function(){var t=l(this.$parent),a=t.map,e=this.ready;a?e():t.$on("ready",e)},this.destroyed=n,this.beforeDestroy=n};a.default=function(t){return new i({type:t})},t.exports=a.default})},wuLl:function(t,a,e){!function(a,e){t.exports=e()}(0,function(){function t(t,a,e){var n,s,l=t.prototype,i=new Function;i.prototype=a.prototype,s=t.prototype=new i;for(n in l)s[n]=l[n];t.prototype.constructor=t,t.superClass=a.prototype,"string"==typeof e&&(s._className=e)}var a=function(){var t=function(t){var a={data:[],heatmap:t};this.max=1,this.get=function(t){return a[t]},this.set=function(t,e){a[t]=e}};t.prototype={addDataPoint:function(t,a){if(!(t<0||a<0)){var e=this,n=e.get("heatmap"),s=e.get("data");if(s[t]||(s[t]=[]),s[t][a]||(s[t][a]=0),s[t][a]+=arguments.length<3?1:arguments[2],e.set("data",s),e.max<s[t][a])return n.get("actx").clearRect(0,0,n.get("width"),n.get("height")),void e.setDataSet({max:s[t][a],data:s},!0);n.drawAlpha(t,a,s[t][a],!0)}},setDataSet:function(t,a){var e=this,n=e.get("heatmap"),s=[],l=t.data,i=l.length;if(n.clear(),this.max=t.max,n.get("legend")&&n.get("legend").update(t.max),null!=a&&a){for(var o in l)if(void 0!==o)for(var r in l[o])void 0!==r&&n.drawAlpha(o,r,l[o][r],!1)}else for(;i--;){var c=l[i];n.drawAlpha(c.x,c.y,c.count,!1),s[c.x]||(s[c.x]=[]),s[c.x][c.y]||(s[c.x][c.y]=0),s[c.x][c.y]=c.count}n.colorize(),this.set("data",l)},exportDataSet:function(){var t=this,a=t.get("data"),e=[];for(var n in a)if(void 0!==n)for(var s in a[n])void 0!==s&&e.push({x:parseInt(n,10),y:parseInt(s,10),count:a[n][s]});return{max:t.max,data:e}},generateRandomDataSet:function(t){var a=this.get("heatmap"),e=a.get("width"),n=a.get("height"),s={},l=Math.floor(1e3*Math.random()+1);s.max=l;for(var i=[];t--;)i.push({x:Math.floor(Math.random()*e+1),y:Math.floor(Math.random()*n+1),count:Math.floor(Math.random()*l+1)});s.data=i,this.setDataSet(s)}};var a=function(t){this.config=t;var a={element:null,labelsEl:null,gradientCfg:null,ctx:null};this.get=function(t){return a[t]},this.set=function(t,e){a[t]=e},this.init()};a.prototype={init:function(){var t,a,e=this,n=e.config,s=n.title||"Legend",l=n.position,i=n.offset||10,o=(n.gradient,document.createElement("ul")),r="";e.processGradientObject(),l.indexOf("t")>-1?r+="top:"+i+"px;":r+="bottom:"+i+"px;",l.indexOf("l")>-1?r+="left:"+i+"px;":r+="right:"+i+"px;",t=document.createElement("div"),t.style.cssText="border-radius:5px;position:absolute;"+r+"font-family:Helvetica; width:256px;z-index:10000000000; background:rgba(255,255,255,1);padding:10px;border:1px solid black;margin:0;",t.innerHTML="<h3 style='padding:0;margin:0;text-align:center;font-size:16px;'>"+s+"</h3>",o.style.cssText="position:relative;font-size:12px;display:block;list-style:none;list-style-type:none;margin:0;height:15px;",a=document.createElement("div"),a.style.cssText=["position:relative;display:block;width:256px;height:15px;border-bottom:1px solid black; background-image:url(",e.createGradientImage(),");"].join(""),t.appendChild(o),t.appendChild(a),e.set("element",t),e.set("labelsEl",o),e.update(1)},processGradientObject:function(){var t=this,a=this.config.gradient,e=[];for(var n in a)a.hasOwnProperty(n)&&e.push({stop:n,value:a[n]});e.sort(function(t,a){return t.stop-a.stop}),e.unshift({stop:0,value:"rgba(0,0,0,0)"}),t.set("gradientArr",e)},createGradientImage:function(){var t,a=this,e=a.get("gradientArr"),n=e.length,s=document.createElement("canvas"),l=s.getContext("2d");s.width="256",s.height="15",t=l.createLinearGradient(0,5,256,10);for(var i=0;i<n;i++)t.addColorStop(1/(n-1)*i,e[i].value);l.fillStyle=t,l.fillRect(0,5,256,10),l.strokeStyle="black",l.beginPath();for(var i=0;i<n;i++)l.moveTo(.5+(1/(n-1)*i*256>>0),0),l.lineTo(.5+(1/(n-1)*i*256>>0),0==i?15:5);return l.moveTo(255.5,0),l.lineTo(255.5,15),l.moveTo(255.5,4.5),l.lineTo(0,4.5),l.stroke(),a.set("ctx",l),s.toDataURL()},getElement:function(){return this.get("element")},update:function(t){for(var a,e,n=this,s=n.get("gradientArr"),l=n.get("ctx"),i=n.get("labelsEl"),o="",r=0;r<s.length;r++)a=t*s[r].stop>>0,e=l.measureText(a).width/2>>0,0==r&&(e=0),r==s.length-1&&(e*=2),o+='<li style="position:absolute;left:'+(((1/(s.length-1)*r*256||0)>>0)-e+.5)+'px">'+a+"</li>";i.innerHTML=o}};var e=function(a){var e={radius:40,element:{},canvas:{},acanvas:{},ctx:{},actx:{},legend:null,visible:!0,width:0,height:0,max:!1,gradient:!1,opacity:180,premultiplyAlpha:!1,bounds:{l:1e3,r:0,t:1e3,b:0},debug:!1};this.store=new t(this),this.get=function(t){return e[t]},this.set=function(t,a){e[t]=a},this.configure(a),this.init()};return e.prototype={configure:function(t){var e=this;if(e.set("radius",t.radius||40),e.set("element",t.element instanceof Object?t.element:document.getElementById(t.element)),e.set("visible",null==t.visible||t.visible),e.set("max",t.max||!1),e.set("gradient",t.gradient||{.45:"rgb(0,0,255)",.55:"rgb(0,255,255)",.65:"rgb(0,255,0)",.95:"yellow",1:"rgb(255,0,0)"}),e.set("opacity",parseInt(255/(100/t.opacity),10)||180),e.set("width",t.width||0),e.set("height",t.height||0),e.set("debug",t.debug),t.legend){var n=t.legend;n.gradient=e.get("gradient"),e.set("legend",new a(n))}},resize:function(){var t=this,a=t.get("element"),e=t.get("canvas"),n=t.get("acanvas");e.width=n.width=t.get("width")||a.style.width.replace(/px/,"")||t.getWidth(a),this.set("width",e.width),e.height=n.height=t.get("height")||a.style.height.replace(/px/,"")||t.getHeight(a),this.set("height",e.height)},init:function(){var t=this,a=document.createElement("canvas"),e=document.createElement("canvas"),n=a.getContext("2d"),s=e.getContext("2d"),l=t.get("element");t.initColorPalette(),t.set("canvas",a),t.set("ctx",n),t.set("acanvas",e),t.set("actx",s),t.resize(),a.style.cssText=e.style.cssText="position:absolute;top:0;left:0;z-index:10000000;",t.get("visible")||(a.style.display="none"),l.appendChild(a),t.get("legend")&&l.appendChild(t.get("legend").getElement()),t.get("debug")&&document.body.appendChild(e),s.shadowOffsetX=15e3,s.shadowOffsetY=15e3,s.shadowBlur=15},initColorPalette:function(){var t,a,e,n=this,s=document.createElement("canvas"),l=n.get("gradient");s.width="1",s.height="256",t=s.getContext("2d"),a=t.createLinearGradient(0,0,1,256),e=t.getImageData(0,0,1,1),e.data[0]=e.data[3]=64,e.data[1]=e.data[2]=0,t.putImageData(e,0,0),e=t.getImageData(0,0,1,1),n.set("premultiplyAlpha",e.data[0]<60||e.data[0]>70);for(var i in l)a.addColorStop(i,l[i]);t.fillStyle=a,t.fillRect(0,0,1,256),n.set("gradient",t.getImageData(0,0,1,256).data)},getWidth:function(t){var a=t.offsetWidth;return t.style.paddingLeft&&(a+=t.style.paddingLeft),t.style.paddingRight&&(a+=t.style.paddingRight),a},getHeight:function(t){var a=t.offsetHeight;return t.style.paddingTop&&(a+=t.style.paddingTop),t.style.paddingBottom&&(a+=t.style.paddingBottom),a},colorize:function(t,a){var e,n,s,l,i,o,r,c,u,h=this,d=h.get("width"),p=h.get("radius"),g=h.get("height"),v=h.get("actx"),m=h.get("ctx"),_=3*p,f=h.get("premultiplyAlpha"),y=h.get("gradient"),x=h.get("opacity"),b=h.get("bounds");null!=t&&null!=a?(t+_>d&&(t=d-_),t<0&&(t=0),a<0&&(a=0),a+_>g&&(a=g-_),e=t,n=a,l=t+_,s=a+_):(e=b.l<0?0:b.l,l=b.r>d?d:b.r,n=b.t<0?0:b.t,s=b.b>g?g:b.b),i=v.getImageData(e,n,l-e,s-n),o=i.data.length;for(var C=3;C<o;C+=4)r=i.data[C],c=4*r,c&&(u=r<x?r:x,i.data[C-3]=y[c],i.data[C-2]=y[c+1],i.data[C-1]=y[c+2],f&&(i.data[C-3]/=255/u,i.data[C-2]/=255/u,i.data[C-1]/=255/u),i.data[C]=u);m.putImageData(i,e,n)},drawAlpha:function(t,a,e,n){var s=this,l=s.get("radius"),i=s.get("actx"),o=(s.get("max"),s.get("bounds")),r=t-1.5*l>>0,c=a-1.5*l>>0,u=t+1.5*l>>0,h=a+1.5*l>>0;i.shadowColor="rgba(0,0,0,"+(e?e/s.store.max:"0.1")+")",i.shadowOffsetX=15e3,i.shadowOffsetY=15e3,i.shadowBlur=15,i.beginPath(),i.arc(t-15e3,a-15e3,l,0,2*Math.PI,!0),i.closePath(),i.fill(),n?s.colorize(r,c):(r<o.l&&(o.l=r),c<o.t&&(o.t=c),u>o.r&&(o.r=u),h>o.b&&(o.b=h))},toggleDisplay:function(){var t=this,a=t.get("visible"),e=t.get("canvas");e.style.display=a?"none":"block",t.set("visible",!a)},getImageData:function(){return this.get("canvas").toDataURL()},clear:function(){var t=this,a=t.get("width"),e=t.get("height");t.store.set("data",[]),t.get("ctx").clearRect(0,0,a,e),t.get("actx").clearRect(0,0,a,e)},cleanup:function(){var t=this;t.get("element").removeChild(t.get("canvas"))}},{create:function(t){return new e(t)},util:{mousePosition:function(t){var a,e;if(t.layerX?(a=t.layerX,e=t.layerY):t.offsetX&&(a=t.offsetX,e=t.offsetY),void 0!==a)return[a,e]}}}}(),e=function(a){try{BMap}catch(t){throw Error("Baidu Map JS API is not ready yet!")}if(!e._isExtended){e._isExtended=!0,t(e,BMap.Overlay,"HeatmapOverlay");var n=new e(a);this.__proto__=n.__proto__}this.conf=a,this.heatmap=null,this.latlngs=[],this.bounds=null,this._moveendHandler=this._moveendHandler.bind(this)};return e.prototype.initialize=function(t){this._map=t;var e=document.createElement("div");return e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.border=0,e.style.width=this._map.getSize().width+"px",e.style.height=this._map.getSize().height+"px",this.conf.element=e,t.getPanes().mapPane.appendChild(e),this.heatmap=a.create(this.conf),this._div=e,e},e.prototype.draw=function(){var t=this._map.getBounds();if(!t.equals(this.bounds)){this.bounds=t;var a=this._map.pointToOverlayPixel(t.getNorthEast()),e=this._map.pointToOverlayPixel(t.getSouthWest());if(a&&e){var n=a.y,s=e.x,l=e.y-a.y,i=a.x-e.x;if(this.conf.element.style.left=s+"px",this.conf.element.style.top=n+"px",this.conf.element.style.width=i+"px",this.conf.element.style.height=l+"px",this.heatmap.store.get("heatmap").resize(),this.latlngs.length>0){this.heatmap.clear();for(var o=this.latlngs.length,r={max:this.heatmap.store.max,data:[]};o--;){var c=this.latlngs[o].latlng;if(t.containsPoint(c)){var u=this._map.pointToOverlayPixel(c),h=new BMap.Pixel(u.x-s,u.y-n),d=this.pixelTransform(h);r.data.push({x:d.x,y:d.y,count:this.latlngs[o].c})}}this.heatmap.store.setDataSet(r)}}}},e.prototype.pixelTransform=function(t){for(var a=this.heatmap.get("width"),e=this.heatmap.get("height");t.x<0;)t.x+=a;for(;t.x>a;)t.x-=a;for(;t.y<0;)t.y+=e;for(;t.y>e;)t.y-=e;return t.x=t.x>>0,t.y=t.y>>0,t},e.prototype._moveendHandler=function(t){this.setDataSet(this._data),delete this._data,this._map.removeEventListener("moveend",this._moveendHandler)},e.prototype.setDataSet=function(t){if(this._map){var a=this._map.getBounds(),e=this._map.pointToOverlayPixel(a.getNorthEast()),n=this._map.pointToOverlayPixel(a.getSouthWest());e&&n||(this._data=t,this._map.addEventListener("moveend",this._moveendHandler));var s={max:t.max,data:[]},l=t.data,i=l.length;for(this.latlngs=[];i--;){var o=new BMap.Point(l[i].lng,l[i].lat);if(this.latlngs.push({latlng:o,c:l[i].count}),a.containsPoint(o)){var r=this._map.pointToOverlayPixel(o),c=this._map.pointToOverlayPixel(a.getSouthWest()).x,u=this._map.pointToOverlayPixel(a.getNorthEast()).y,h=new BMap.Pixel(r.x-c,r.y-u),d=this.pixelTransform(h);s.data.push({x:d.x,y:d.y,count:l[i].count})}}this.heatmap.clear(),this.heatmap.store.setDataSet(s)}},e.prototype.addDataPoint=function(t,a,e){var n=new BMap.Point(t,a),s=this.pixelTransform(this._map.pointToOverlayPixel(n));this.heatmap.store.addDataPoint(s.x,s.y,e),this.latlngs.push({latlng:n,c:e})},e.prototype.toggle=function(){this.heatmap.toggleDisplay()},e})}});